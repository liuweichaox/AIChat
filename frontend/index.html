<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8" />
  <title>语音助手</title>
  <link rel="stylesheet" href="/static/style.css" />
  <script type="module" src="https://unpkg.com/vue@3/dist/vue.esm-browser.js"></script>
  <script type="module" src="/static/app.js"></script>
</head>

<body>
  <div id="app">
    <h1>欢迎使用语音助手，点击开始说话</h1>
    <div class="video-container">
      <video ref="localVideo" autoplay muted playsinline></video>
      <video ref="remoteVideo" autoplay playsinline></video>
    </div>

    <div class="controls">
      <button @click="toggleMic">
        <span v-if="!recording">🎙 开始</span>
        <span v-else>⏹ 停止</span>
      </button>

      <button class="icon secondary" @click="toggleSubtitles" :title="showSubtitles ? '隐藏字幕' : '显示字幕'">
        <!-- 眼睛 / 眼睛划线 SVG -->
        <svg v-if="showSubtitles" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
          <circle cx="12" cy="12" r="3"></circle>
        </svg>
        <svg v-else width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <path
            d="M17.94 17.94A10.94 10.94 0 0 1 12 20c-7 0-11-8-11-8a21.76 21.76 0 0 1 5.06-6.94M9.9 4.24A10.94 10.94 0 0 1 12 4c7 0 11 8 11 8a21.83 21.83 0 0 1-3.19 4.62M1 1l22 22">
          </path>
        </svg>
      </button>

      <button class="icon secondary" @click="toggleVideo">
        <span v-if="!videoEnabled">📹 视频</span>
        <span v-else>⏹ 关闭视频</span>
      </button>

      <span class="badge" v-if="recording && listening">在听你说话…</span>
      <span class="badge" v-if="typing">机器人回复中…</span>
    </div>

    <div class="history" ref="historyEl" :class="{ hidden: !showSubtitles }">
      <div v-for="(msg, idx) in history" :key="idx" :class="['message', msg.role]">
        {{ msg.text }}
      </div>
      <div class="message user" v-if="userText">{{ userText }}</div>
      <div class="message bot" v-if="reply.length">
        <span v-for="token in reply" :key="token.id" class="token">{{ token.text }}</span>
        <span class="cursor" v-if="listening || typing">▋</span>
      </div>
    </div>

    <div v-if="error" class="error">⚠️ {{ error }}</div>
  </div>

</body>

</html>